FROM python:3.11-slim AS base
WORKDIR /app
COPY fastapi/requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt
COPY fastapi/ ./
ENV UVICORN_HOST=0.0.0.0 \
    UVICORN_PORT=8080 \
    UVICORN_WORKERS=2
EXPOSE 8080
CMD ["/bin/sh", "-lc", "python -m uvicorn app:app --host ${UVICORN_HOST:-0.0.0.0} --port ${UVICORN_PORT:-8080} --workers ${UVICORN_WORKERS:-2}"]
